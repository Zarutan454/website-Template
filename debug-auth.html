<!DOCTYPE html>
<html>
<head>
    <title>Auth Debug</title>
</head>
<body>
    <h1>BSN Auth Debug</h1>
    <div id="output"></div>
    
    <script>
        const output = document.getElementById('output');
        
        function log(message) {
            console.log(message);
            output.innerHTML += '<p>' + message + '</p>';
        }
        
        async function debugAuth() {
            log('=== BSN Authentication Debug ===');
            
            // Check localStorage tokens
            const accessToken = localStorage.getItem('access_token');
            const refreshToken = localStorage.getItem('refresh_token');
            const user = localStorage.getItem('user');
            
            log(`Access Token: ${accessToken ? 'EXISTS' : 'MISSING'}`);
            log(`Refresh Token: ${refreshToken ? 'EXISTS' : 'MISSING'}`);
            log(`User Data: ${user ? 'EXISTS' : 'MISSING'}`);
            
            if (user) {
                try {
                    const userData = JSON.parse(user);
                    log(`User: ${userData.username} (ID: ${userData.id})`);
                } catch (e) {
                    log('Error parsing user data: ' + e.message);
                }
            }
            
            // Test API connectivity
            if (accessToken) {
                try {
                    log('Testing API connectivity...');
                    const response = await fetch('http://localhost:8000/api/users/profile/', {
                        headers: {
                            'Authorization': `Bearer ${accessToken}`,
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    log(`Profile API Response: ${response.status} ${response.statusText}`);
                    
                    if (response.ok) {
                        const data = await response.json();
                        log(`Profile Data: ${JSON.stringify(data, null, 2)}`);
                    }
                    
                    // Test posts API
                    const postsResponse = await fetch('http://localhost:8000/api/posts/', {
                        headers: {
                            'Authorization': `Bearer ${accessToken}`,
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    log(`Posts API Response: ${postsResponse.status} ${postsResponse.statusText}`);
                    
                    if (postsResponse.ok) {
                        const postsData = await postsResponse.json();
                        log(`Posts Count: ${postsData.results ? postsData.results.length : 0}`);
                    }
                    
                } catch (error) {
                    log('API Error: ' + error.message);
                }
            } else {
                log('No access token - cannot test API');
            }
        }
        
        debugAuth();
    </script>
</body>
</html> 